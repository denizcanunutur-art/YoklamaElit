<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Elit EÄŸitim Kurumu - Yoklama Sistemi</title>
<style>
:root{--red:#e74c3c;--blue:#2d6cdf;--green:#25d366;--muted:#f7f7f7;--gray:#bdbdbd;}
*{box-sizing:border-box;margin:0;padding:0;}
body{
  font-family:"Montserrat",Arial,sans-serif;
  background:url('IMG_4035.JPG') center/cover no-repeat;
  color:#222;
}
header{
  background:rgba(255,255,255,0.92);
  padding:20px 12px;
  text-align:center;
  box-shadow:0 2px 8px rgba(0,0,0,0.06);
}
header h1{margin:0;font-size:28px;font-weight:800}
header h1 span{color:var(--red)}
header h2{margin:6px 0 0 0;font-size:15px;color:#555;font-weight:600}

main{display:flex;gap:18px;padding:18px;flex-wrap:wrap;justify-content:center}
.panel{background:rgba(255,255,255,0.96);border-radius:10px;padding:14px;box-shadow:0 6px 20px rgba(0,0,0,0.05);flex:1 1 420px;min-width:300px;position:relative}
h3{margin:0 0 10px 0;font-size:18px}

.table-wrap{max-height:440px;overflow-y:auto;overflow-x:hidden;border-radius:6px;border:1px solid #e6e6e6;background:#fff}
table{width:100%;border-collapse:collapse;min-width:300px}
thead th{position:sticky;top:0;background:var(--muted);border-bottom:1px solid #e6e6e6;padding:10px;font-weight:700;text-align:left}
tbody td{padding:10px;border-bottom:1px solid #f0f0f0;text-align:left}
tbody tr:hover{background:rgba(0,0,0,0.03)}
td.name{font-weight:700}

.status-cell{width:110px;text-align:center;cursor:pointer;border-radius:6px;padding:6px;font-weight:700}
.status-empty{background:transparent;color:#333}
.status-absent{background:#ffd8d8;color:#800}
.status-present{background:#d6ffd9;color:#064}

/* Buttons */
.btn{display:inline-block;padding:8px 12px;border-radius:8px;border:0;cursor:pointer;font-weight:700}
.btn-primary{background:var(--blue);color:#fff}
.btn-danger{background:#ff6b6b;color:#fff}
.btn-wa{background:var(--green);color:#fff}
.btn-notify{background:#4a69bd;color:#fff;margin-left:10px}
.btn-panel{
  position:absolute;
  right:14px;
  top:14px;
  background:var(--gray);
  color:#fff;
}
.btn-class{background:#eee;color:var(--blue);margin:2px;padding:6px 10px;border-radius:6px;cursor:pointer;font-weight:700}

/* Ana menÃ¼ */
#selectionScreen{
  display:flex;
  flex-direction:column;
  align-items:center;
  justify-content:center;
  height:100vh;
  background:rgba(255,255,255,0.8);
  text-align:center;
}
.menu-btn{
  background:var(--blue);
  color:#fff;
  border:0;
  border-radius:10px;
  padding:20px 40px;
  margin:12px;
  font-size:20px;
  font-weight:800;
  cursor:pointer;
  box-shadow:0 6px 15px rgba(0,0,0,0.15);
  transition:transform 0.15s;
}
.menu-btn:hover{transform:scale(1.05)}

/* Panel (modal) */
#overlay{display:none;position:fixed;inset:0;background:rgba(0,0,0,0.45);z-index:40}
#panel{display:none;position:fixed;left:50%;top:50%;transform:translate(-50%,-50%);z-index:50;width:92%;max-width:520px}
#panel .panel-inner{background:#fff;padding:18px;border-radius:10px;box-shadow:0 12px 30px rgba(0,0,0,0.2)}
.panel-inner input{width:100%;padding:10px;margin:6px 0;border-radius:8px;border:1px solid #dcdcdc}

#classButtons{display:flex;flex-wrap:wrap;justify-content:center;margin-bottom:12px;}

.back-btn{
  position:absolute;
  top:18px;
  left:18px;
  background:#999;
  color:#fff;
  border:0;
  border-radius:8px;
  padding:8px 14px;
  cursor:pointer;
  font-weight:700;
}

@media (max-width:900px){
  main{flex-direction:column;padding:12px}
  .table-wrap{max-height:320px}
}
</style>
</head>
<body>

<!-- ANA MENÃœ -->
<div id="selectionScreen">
  <h1 style="font-size:32px;margin-bottom:20px;"><span style="color:var(--red)">Elit</span> EÄŸitim Kurumu</h1>
  <h2 style="color:#333;margin-bottom:30px;">Yoklama Sistemi</h2>
  <button id="btnDers" class="menu-btn">ðŸ“˜ Ders Yoklama</button>
  <button id="btnEtut" class="menu-btn">ðŸŽ“ EtÃ¼t Yoklama</button>
</div>

<!-- YOKLAMA PANELLERÄ° -->
<div id="yoklamaContainer" style="display:none;">
  <header>
    <button class="back-btn" id="btnBack">Ana MenÃ¼ye DÃ¶n</button>
    <h1><span>Elit</span> EÄŸitim Kurumu</h1>
    <h2 id="panelTitle">Yoklama Sistemi</h2>
  </header>

  <main>
    <section class="panel" id="yoklamaPanel">
      <h3 id="yoklamaTypeTitle">EtÃ¼t Yoklama Listesi</h3>
      <button class="btn btn-panel" id="btnPanel">Ã–ÄŸrenci Ekle / Ã‡Ä±kar</button>
      <div id="classButtons"></div>
      <div class="table-wrap">
        <table id="studentsTable">
          <thead>
            <tr><th>Ä°sim</th><th>SÄ±nÄ±f</th><th>Durum</th></tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
    </section>

    <section class="panel">
      <h3 style="display:flex;align-items:center;justify-content:space-between">
        Yok Olanlar
        <button class="btn btn-notify" id="btnNotify">Kurumu Bilgilendir</button>
      </h3>
      <div style="height:8px"></div>
      <div class="table-wrap">
        <table id="absentTable">
          <thead><tr><th>Ä°sim</th><th>SÄ±nÄ±f</th><th>WhatsApp</th></tr></thead>
          <tbody></tbody>
        </table>
      </div>
    </section>
  </main>
</div>

<!-- Ã–ÄŸrenci yÃ¶netim paneli -->
<div id="overlay"></div>
<div id="panel" role="dialog" aria-modal="true" aria-hidden="true">
  <div class="panel-inner">
    <h3>Ã–ÄŸrenci YÃ¶netimi</h3>
    <input id="newName" type="text" placeholder="Ad Soyad" />
    <input id="newClass" type="text" placeholder="SÄ±nÄ±f (Ã¶rn: 11Say)" />
    <input id="newPhone" type="text" placeholder="Telefon (Ã¶rn +90...)" />
    <div style="display:flex;gap:8px;margin-top:8px">
      <button class="btn btn-primary" id="btnAdd">Ekle</button>
      <button class="btn" id="btnClear">Temizle</button>
    </div>
    <hr style="margin:12px 0">
    <div style="font-weight:700;margin-bottom:6px">Ã–ÄŸrenci Sil</div>
    <input id="removeName" type="text" placeholder="Silinecek Ã¶ÄŸrenci adÄ±" />
    <div style="display:flex;gap:8px;margin-top:8px">
      <button class="btn btn-danger" id="btnRemove">Sil</button>
      <button class="btn" id="btnClose">Kapat</button>
    </div>
  </div>
</div>

<script type="module">
// --- Firebase ---
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.13.0/firebase-app.js";
import { getFirestore, collection, getDocs, setDoc, doc, deleteDoc } from "https://www.gstatic.com/firebasejs/10.13.0/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyBka7ReTV8sGjR9GAsJUDkksLSCTHCV9Mk",
  authDomain: "elit-yoklama.firebaseapp.com",
  projectId: "elit-yoklama",
  storageBucket: "elit-yoklama.firebasestorage.app",
  messagingSenderId: "30260081027",
  appId: "1:30260081027:web:9332093cbc19d605d506b6"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

const INSTITUTION_PHONE = "+905527112922";
let students = [];
let activeClassFilter = null;

// iki farklÄ± yoklama durumu
let dersStatuses = {};
let etutStatuses = {};
let currentMode = "etut"; // varsayÄ±lan etÃ¼t

// --- MenÃ¼ kontrolÃ¼ ---
document.getElementById("btnDers").addEventListener("click", () => startMode("ders"));
document.getElementById("btnEtut").addEventListener("click", () => startMode("etut"));
document.getElementById("btnBack").addEventListener("click", goBack);

function startMode(mode){
  currentMode = mode;
  document.getElementById("selectionScreen").style.display="none";
  document.getElementById("yoklamaContainer").style.display="block";
  document.getElementById("panelTitle").textContent = (mode==="ders" ? "Ders Yoklama Sistemi" : "EtÃ¼t Yoklama Sistemi");
  document.getElementById("yoklamaTypeTitle").textContent = (mode==="ders" ? "Ders Yoklama Listesi" : "EtÃ¼t Yoklama Listesi");
  loadStudents();
}

function goBack(){
  document.getElementById("selectionScreen").style.display="flex";
  document.getElementById("yoklamaContainer").style.display="none";
  activeClassFilter = null;
}

// --- Firebase Ã¶ÄŸrenci yÃ¼kleme ---
async function loadStudents() {
  students = [];
  const querySnapshot = await getDocs(collection(db, "students"));
  querySnapshot.forEach((docSnap)=>{
    students.push({...docSnap.data()});
  });
  renderClassButtons();
  renderStudentsTable();
}

// --- Render iÅŸlemleri ---
function renderClassButtons(){
  const container = document.getElementById("classButtons");
  container.innerHTML = "";
  const classes = [...new Set(students.map(s=>s.class))].sort();
  classes.forEach(cls=>{
    const btn = document.createElement("button");
    btn.textContent = cls;
    btn.className = "btn-class";
    if(activeClassFilter===cls){
      btn.style.backgroundColor = "var(--blue)";
      btn.style.color = "#fff";
    }
    btn.addEventListener("click", ()=>{
      activeClassFilter = (activeClassFilter===cls)?null:cls;
      renderStudentsTable();
      renderClassButtons();
    });
    container.appendChild(btn);
  });
}

function renderStudentsTable(){
  const tbody = document.querySelector("#studentsTable tbody");
  tbody.innerHTML = "";
  const statusSet = currentMode==="ders" ? dersStatuses : etutStatuses;
  students.filter(s=>!activeClassFilter || s.class===activeClassFilter)
  .forEach(s=>{
    const tr = document.createElement("tr");
    const tdName = document.createElement("td"); tdName.className="name"; tdName.textContent=s.name;
    const tdClass = document.createElement("td"); tdClass.textContent=s.class;
    const tdStatus = document.createElement("td"); tdStatus.className="status-cell";
    const st = statusSet[s.name] || "";
    tdStatus.classList.remove("status-empty","status-absent","status-present");
    if(!st) tdStatus.classList.add("status-empty");
    else if(st==="absent") tdStatus.classList.add("status-absent");
    else if(st==="present") tdStatus.classList.add("status-present");
    tdStatus.textContent = st ? (st==="absent"?"Yok":"Var") : "-";
    tdStatus.addEventListener("click", ()=> toggleStatus(s.name));
    tr.appendChild(tdName);
    tr.appendChild(tdClass);
    tr.appendChild(tdStatus);
    tbody.appendChild(tr);
  });
  renderAbsentTable();
}

function toggleStatus(name){
  const statusSet = currentMode==="ders" ? dersStatuses : etutStatuses;
  const cur = statusSet[name];
  if(!cur) statusSet[name]="absent";
  else if(cur==="absent") statusSet[name]="present";
  else delete statusSet[name];
  renderStudentsTable();
}

function renderAbsentTable(){
  const tbody = document.querySelector("#absentTable tbody");
  tbody.innerHTML = "";
  const statusSet = currentMode==="ders" ? dersStatuses : etutStatuses;
  const absents = students.filter(s=>statusSet[s.name]==="absent");
  absents.forEach(s=>{
    const tr = document.createElement("tr");
    const tdName = document.createElement("td"); tdName.className="name"; tdName.textContent=s.name;
    const tdClass = document.createElement("td"); tdClass.textContent=s.class;
    const tdBtn = document.createElement("td"); tdBtn.style.textAlign="center";
    const btn = document.createElement("button"); btn.className="btn btn-wa"; btn.textContent="GÃ¶nder";
    btn.addEventListener("click", ()=> sendIndividualWA(s.phone,s.name));
    tdBtn.appendChild(btn);
    tr.appendChild(tdName); tr.appendChild(tdClass); tr.appendChild(tdBtn);
    tbody.appendChild(tr);
  });
}

// --- WhatsApp ---
function sendIndividualWA(phone,name){
  const msg = `Merhabalar Ã–ÄŸrencimiz ${name} ${(currentMode==="ders"?"ders":"etÃ¼t")}e katÄ±lmamÄ±ÅŸtÄ±r, bilginize sunarÄ±z.%0AElit EÄŸitim Kurumu`;
  const url = `https://wa.me/${phone.replace(/\+/g,'')}?text=${msg}`;
  window.open(url,"_blank");
}

function notifyInstitution(){
  const statusSet = currentMode==="ders" ? dersStatuses : etutStatuses;
  const absents = students.filter(s=>statusSet[s.name]==="absent").map(s=>s.name);
  if(absents.length===0){ alert("TÃ¼m Ã¶ÄŸrenciler katÄ±ldÄ±, bildirilecek Ã¶ÄŸrenci yok."); return; }
  const message = `${currentMode==="ders"?"Derste":"EtÃ¼tte"} olmayan Ã¶ÄŸrenciler:\n\n${absents.join(", ")}`;
  const url = `https://wa.me/${INSTITUTION_PHONE.replace(/\+/g,'')}?text=${encodeURIComponent(message)}`;
  window.open(url,"_blank");
}

// --- Panel kontrol ---
function openPanel(){ document.getElementById("overlay").style.display="block"; document.getElementById("panel").style.display="block"; }
function closePanel(){ document.getElementById("overlay").style.display="none"; document.getElementById("panel").style.display="none"; }
function clearInputs(){ document.getElementById("newName").value=""; document.getElementById("newClass").value=""; document.getElementById("newPhone").value=""; }

// --- Ã–ÄŸrenci ekle/sil ---
async function addStudent(){
  const name = document.getElementById("newName").value.trim();
  const cls = document.getElementById("newClass").value.trim();
  const phone = document.getElementById("newPhone").value.trim();
  if(!name || !cls){ alert("LÃ¼tfen isim ve sÄ±nÄ±f girin."); return; }
  const exists = students.some(s=>s.name.toLowerCase()===name.toLowerCase());
  if(exists){ alert("Bu isimde Ã¶ÄŸrenci zaten mevcut."); return; }
  const newStudent = {name, class:cls, phone};
  await setDoc(doc(db,"students",name), newStudent);
  students.push(newStudent);
  renderClassButtons(); renderStudentsTable(); clearInputs(); closePanel();
}

async function removeStudent(){
  const name = document.getElementById("removeName").value.trim();
  if(!name){ alert("Silinecek Ã¶ÄŸrencinin adÄ±nÄ± girin."); return; }
  const idx = students.findIndex(s=>s.name.toLowerCase()===name.toLowerCase());
  if(idx===-1){ alert("Bu isimde Ã¶ÄŸrenci bulunamadÄ±."); return; }
  await deleteDoc(doc(db,"students",students[idx].name));
  students.splice(idx,1);
  renderClassButtons(); renderStudentsTable();
  document.getElementById("removeName").value="";
  closePanel();
}

// --- Event listener ---
document.addEventListener("DOMContentLoaded", ()=>{
  document.getElementById("btnPanel").addEventListener("click", openPanel);
  document.getElementById("overlay").addEventListener("click", closePanel);
  document.getElementById("btnClose").addEventListener("click", closePanel);
  document.getElementById("btnClear").addEventListener("click", clearInputs);
  document.getElementById("btnAdd").addEventListener("click", addStudent);
  document.getElementById("btnRemove").addEventListener("click", removeStudent);
  document.getElementById("btnNotify").addEventListener("click", notifyInstitution);
});
</script>
</body>
</html>
