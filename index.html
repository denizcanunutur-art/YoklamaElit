<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Elit Eğitim Kurumu - Yoklama Sistemi</title>
<style>
:root {
  --red: #e74c3c;
  --green: #27ae60;
  --blue: #2d6cdf;
  --gray: #bdc3c7;
}
body {
  font-family: "Poppins", sans-serif;
  background: url('arkaplan.jpg') center/cover no-repeat fixed;
  margin: 0;
  padding: 0;
  color: #222;
  text-align: center;
}
header img {
  width: 90px;
  height: 90px;
  margin-top: 30px;
}
main { display: none; padding: 20px; }

/* --- Giriş Paneli --- */
#loginPanel {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  height: 100vh;
  backdrop-filter: blur(6px);
}
.login-btn {
  background-color: var(--blue);
  color: white;
  border: none;
  padding: 12px 24px;
  border-radius: 6px;
  cursor: pointer;
  margin: 8px;
  font-size: 16px;
  transition: 0.3s;
}
.login-btn:hover { opacity: 0.85; }

#passwordPanel {
  display: none;
  flex-direction: column;
  background: rgba(255,255,255,0.95);
  padding: 25px;
  border-radius: 10px;
  box-shadow: 0 0 10px rgba(0,0,0,0.2);
}
input[type="password"] {
  padding: 10px;
  margin-top: 10px;
  border-radius: 5px;
  border: 1px solid var(--gray);
}

/* --- Öğretmen Paneli --- */
#yoklamaPanel {
  display: none;
}
#classButtons {
  display: flex;
  flex-wrap: wrap;
  justify-content: center;
  gap: 8px;
  margin-bottom: 10px;
}
.btn-class {
  border: none;
  padding: 8px 14px;
  border-radius: 5px;
  background: var(--gray);
  cursor: pointer;
}
table {
  width: 100%;
  border-collapse: collapse;
  margin-top: 10px;
  background: rgba(255,255,255,0.9);
  border-radius: 8px;
  overflow: hidden;
}
th, td {
  padding: 10px;
  border-bottom: 1px solid #ddd;
}
.status-cell { cursor: pointer; font-weight: bold; }
.status-present { color: var(--green); }
.status-absent { color: var(--red); }
.status-empty { color: var(--gray); }

/* --- Veli Paneli --- */
#parentTableWrap {
  display: none;
  max-height: 80vh;
  overflow-y: auto;
  margin: 0 auto;
  width: 90%;
  background: rgba(255,255,255,0.9);
  padding: 10px;
  border-radius: 10px;
}
#parentSearch {
  padding: 10px;
  width: 80%;
  margin: 10px 0;
  border-radius: 6px;
  border: 1px solid var(--gray);
}
.parent-card {
  display: flex;
  align-items: center;
  justify-content: start;
  gap: 10px;
  padding: 8px;
  border-bottom: 1px solid #ddd;
}
.status-dot {
  width: 14px;
  height: 14px;
  border-radius: 50%;
}
.status-present-dot { background: var(--green); }
.status-absent-dot { background: var(--red); }

/* --- Panel Arka Planı --- */
#overlay {
  display:none;
  position:fixed;
  top:0; left:0;
  width:100%; height:100%;
  background:rgba(0,0,0,0.5);
}
#panel {
  display:none;
  position:fixed;
  top:50%; left:50%;
  transform:translate(-50%,-50%);
  background:white;
  padding:20px;
  border-radius:10px;
  width:90%;
  max-width:400px;
}
</style>
</head>
<body>

<header>
  <img src="logo.png" alt="Elit Eğitim Kurumu Logosu">
</header>

<!-- GİRİŞ PANELİ -->
<div id="loginPanel">
  <h2>Giriş Yap</h2>
  <button class="login-btn" id="teacherBtn">Öğretmen Girişi</button>
  <button class="login-btn" id="parentBtn">Veli Girişi</button>
  
  <div id="passwordPanel">
    <h3>Şifre Giriniz</h3>
    <input type="password" id="teacherPassword" placeholder="Şifre">
    <button class="login-btn" id="teacherLoginBtn">Giriş</button>
  </div>
</div>

<main>
  <!-- ÖĞRETMEN PANELİ -->
  <section id="yoklamaPanel">
    <h2>Etüt Yoklama Sistemi</h2>
    <div id="classButtons"></div>
    <table id="studentsTable">
      <thead>
        <tr><th>İsim</th><th>Sınıf</th><th>Durum</th></tr>
      </thead>
      <tbody></tbody>
    </table>
    <br>
    <button class="login-btn" id="btnPanel">Öğrenci Ekle / Sil</button>
  </section>

  <!-- VELİ PANELİ -->
  <section id="parentTableWrap">
    <input type="text" id="parentSearch" placeholder="Öğrenci Ara...">
    <div id="parentCards"></div>
  </section>
</main>

<!-- EKLE / SİL PANELİ -->
<div id="overlay"></div>
<div id="panel">
  <h3>Öğrenci İşlemleri</h3>
  <input id="newName" placeholder="İsim"><br><br>
  <input id="newClass" placeholder="Sınıf"><br><br>
  <input id="newPhone" placeholder="Telefon"><br><br>
  <button class="login-btn" id="btnAdd">Ekle</button>
  <br><br>
  <input id="removeName" placeholder="Silinecek İsim"><br><br>
  <button class="login-btn" id="btnRemove">Sil</button>
  <br><br>
  <button class="login-btn" id="btnClose">Kapat</button>
</div>

<!-- FIREBASE VE ANA SCRIPT -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
import { getFirestore, collection, getDocs, setDoc, deleteDoc, doc, updateDoc } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "API_KEYİNİ_BURAYA_YAZ",
  authDomain: "elit-yoklama.firebaseapp.com",
  projectId: "elit-yoklama",
  storageBucket: "elit-yoklama.appspot.com",
  messagingSenderId: "1234567890",
  appId: "1:1234567890:web:xxxxxx"
};
const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

let students = [];
let statuses = {};
let activeClassFilter = null;
let isParentMode = false;

// --- Öğrenci Yükleme ---
async function loadStudents() {
  students = [];
  const q = await getDocs(collection(db, "students"));
  q.forEach(docSnap => students.push(docSnap.data()));
  renderClassButtons();
  renderStudentsTable();
  renderParentCards();
}

// --- Öğretmen Girişi ---
const teacherBtn = document.getElementById("teacherBtn");
const parentBtn = document.getElementById("parentBtn");
const passwordPanel = document.getElementById("passwordPanel");
const teacherPassword = document.getElementById("teacherPassword");
const teacherLoginBtn = document.getElementById("teacherLoginBtn");

teacherBtn.addEventListener("click", () => {
  passwordPanel.style.display = "flex";
});

parentBtn.addEventListener("click", () => {
  isParentMode = true;
  document.getElementById("loginPanel").style.display = "none";
  document.querySelector("main").style.display = "block";

  document.getElementById("yoklamaPanel").style.display = "none";
  document.getElementById("parentTableWrap").style.display = "block";
  loadStudents();
});

teacherLoginBtn.addEventListener("click", () => {
  if (teacherPassword.value === "elit") {
    document.getElementById("loginPanel").style.display = "none";
    document.querySelector("main").style.display = "block";

    document.getElementById("parentTableWrap").style.display = "none";
    document.getElementById("yoklamaPanel").style.display = "block";
    isParentMode = false;
    loadStudents();
  } else {
    alert("Şifre yanlış!");
  }
});

// --- Sınıf Butonları ---
function renderClassButtons() {
  const container = document.getElementById("classButtons");
  container.innerHTML = "";
  const classes = [...new Set(students.map(s => s.class))].sort();
  classes.forEach(cls => {
    const btn = document.createElement("button");
    btn.textContent = cls;
    btn.className = "btn-class";
    if (activeClassFilter === cls) {
      btn.style.backgroundColor = "#2d6cdf";
      btn.style.color = "#fff";
    }
    btn.addEventListener("click", () => {
      activeClassFilter = (activeClassFilter === cls) ? null : cls;
      renderClassButtons();
      renderStudentsTable();
    });
    container.appendChild(btn);
  });
}

// --- Öğrenci Tablosu ---
function renderStudentsTable() {
  const tbody = document.querySelector("#studentsTable tbody");
  tbody.innerHTML = "";
  students.filter(s => !activeClassFilter || s.class === activeClassFilter)
  .forEach(s => {
    const tr = document.createElement("tr");
    const tdName = document.createElement("td");
    tdName.textContent = s.name;
    const tdClass = document.createElement("td");
    tdClass.textContent = s.class;
    const tdStatus = document.createElement("td");
    const st = s.status || "";
    tdStatus.textContent = st === "present" ? "Var" : st === "absent" ? "Yok" : "-";
    tdStatus.className = "status-cell " + (st ? (st === "present" ? "status-present" : "status-absent") : "status-empty");
    tdStatus.addEventListener("click", () => toggleStatus(s.name));
    tr.append(tdName, tdClass, tdStatus);
    tbody.appendChild(tr);
  });
}

function toggleStatus(name) {
  const student = students.find(s => s.name === name);
  if (!student) return;
  if (!student.status) student.status = "absent";
  else if (student.status === "absent") student.status = "present";
  else student.status = "";
  updateStatusFirebase(name, student.status);
  renderStudentsTable();
}

async function updateStatusFirebase(name, status) {
  const docRef = doc(db, "students", name);
  await updateDoc(docRef, { status });
}

// --- Veli Görünümü ---
function renderParentCards() {
  const container = document.getElementById("parentCards");
  const searchText = document.getElementById("parentSearch").value.toLowerCase();
  container.innerHTML = "";
  students.filter(s => s.name.toLowerCase().includes(searchText)).forEach(s => {
    const card = document.createElement("div");
    card.className = "parent-card";
    const dot = document.createElement("div");
    dot.className = "status-dot " + (s.status === "present" ? "status-present-dot" : "status-absent-dot");
    const name = document.createElement("span");
    name.textContent = `${s.name} (${s.class})`;
    card.append(dot, name);
    container.appendChild(card);
  });
}
document.getElementById("parentSearch").addEventListener("input", renderParentCards);

// --- Ekle / Sil Paneli ---
document.getElementById("btnPanel").addEventListener("click", () => {
  document.getElementById("overlay").style.display = "block";
  document.getElementById("panel").style.display = "block";
});
document.getElementById("overlay").addEventListener("click", closePanel);
document.getElementById("btnClose").addEventListener("click", closePanel);

function closePanel() {
  document.getElementById("overlay").style.display = "none";
  document.getElementById("panel").style.display = "none";
}

document.getElementById("btnAdd").addEventListener("click", async () => {
  const name = document.getElementById("newName").value.trim();
  const cls = document.getElementById("newClass").value.trim();
  const phone = document.getElementById("newPhone").value.trim();
  if (!name || !cls) { alert("İsim ve sınıf girin."); return; }
  const newStudent = { name, class: cls, phone, status: "" };
  await setDoc(doc(db, "students", name), newStudent);
  students.push(newStudent);
  renderClassButtons(); renderStudentsTable();
  closePanel();
});

document.getElementById("btnRemove").addEventListener("click", async () => {
  const name = document.getElementById("removeName").value.trim();
  if (!name) return;
  await deleteDoc(doc(db, "students", name));
  students = students.filter(s => s.name !== name);
  renderClassButtons(); renderStudentsTable();
  closePanel();
});
</script>
</body>
</html>
